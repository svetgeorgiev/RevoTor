<!doctype html>
<html lang='en'>
   <head>
      <meta charset='utf-8'>
      <meta name='viewport' content='width=device-width, initial-scale=1'>
      <meta name='description' content='Dashboard'>
      <link rel='stylesheet' href='https://revotorsys.com/css/custom.css'/>
      <link rel='stylesheet' href='https://getbootstrap.com/docs/5.2/dist/css/bootstrap.min.css'/>
      <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'/>
      <link rel='icon' href='https://revotorsys.com/assets/favico.ico'>
      <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css'>
      <script src='https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js'></script>
	  <title>Ground Mode - RevoTOR Systems</title>
<script>
function updateData() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var data = JSON.parse(this.responseText);
      document.getElementById('sats').innerHTML = data.sats;
      document.getElementById('altitude').innerHTML = data.altitude;
      document.getElementById('speed').innerHTML = data.speed;
      document.getElementById('latitude').innerHTML = data.latitude;
      document.getElementById('longitude').innerHTML = data.longitude;
      document.getElementById('battery').innerHTML = data.battery + '%';
      updateMap(parseFloat(data.latitude), parseFloat(data.longitude));
    }
  };
  xhttp.open('GET', '/data', true);
  xhttp.send();
}

// Call the updateData function every 1 second
setInterval(updateData, 1000);
</script>

   </head>
   <body>
      <main>
         <div class='container py-4'>
<header class='pb-3 mb-4 fs-4 fw-bold border-bottom'>
  <div class='d-flex justify-content-between align-items-center'>
    <a href='/' class='d-flex align-items-center text-dark text-decoration-none'>
      <img src='https://www.revotorsys.com/assets/revotor_logo.png' width='350' height='75' role='logo'>
    </a>
    <div class='text-center'>
      <i class='fas fa-terminal fs-4 fw-bold'></i> : <span class='fs-4 fw-bold' id='mode'>{MODE}</span>
    </div>
    <div class='text-start align-items-center'>
     <i class='fas fa-car-battery'></i> : <span id='battery'>{BATTERY_LEVEL}%</span><br>
     <i class='fas fa-satellite-dish'></i> : <span id='sats'>{SATS}</span>
    </div>
  </div>
</header>
            <!-- Inlcude Map with GPS Position -->
			<div class='p-0 mb-3 bg-light rounded-3' id='mapid' style='height: 500px; width: 100%;'></div>
            <!-- Include Artificial Horizont -->
			<div class='row align-items-md-stretch'>
               <div class='col-md-4'>
                  <div class='artificial-horizon' style='height: 190px;'>
                     <div class='sky'></div>
                     <div class='ground'></div>
                     <div class='pitch'>
                        <div class='roll'></div>
                     </div>
                  </div>
               </div>
			   <div class='col-md-1'>
			   </div>
               <!-- Include Altitude, Speed, Latitude and Longitude -->
<div class='col-md-3'>
  <div class='d-flex flex-column justify-content-between h-100'>
    <div class='mb-3'>
      <h4>Altitude</h4>
      <div class='d-flex align-items-center'>
        <i class='fa-solid fa-arrow-up-wide-short fs-3'></i>
        <h1 class='mb-0 mx-3'><span id='altitude'>{ALTITUDE}</span></h1>
      </div>
    </div>
    <div>
      <h4>Speed</h4>
      <div class='d-flex align-items-center'>
        <i class='fa-solid fa-gauge-high fs-3'></i>
        <h1 class='mb-0 mx-3'><span id='speed'>{SPEED}</span></h1>
      </div>
    </div>
  </div>
</div>
<div class='col-md-3'>
  <div class='d-flex flex-column justify-content-between h-100'>
    <div class='mb-3'>
      <h4>Latitude</h4>
      <div class='d-flex align-items-center'>
        <i class='fa-solid fa-map-pin fs-3'></i>
        <h1 class='mb-0 mx-3'><span id='latitude'>{LATITUDE}</span></h1>
      </div>
    </div>
    <div>
      <h4>Longitude</h4>
      <div class='d-flex align-items-center'>
        <i class='fa-solid fa-map-pin fs-3'></i>
        <h1 class='mb-0 mx-3'><span id='longitude'>{LONGITUDE}</span></h1>
      </div>
    </div>
  </div>
</div>

            </div>

            <footer class='pt-3 mt-4 text-muted border-top'> RevoTOR Systems Â© 2023 </footer>
         </div>
      </main>
   </body>
</html>
<script>
  
  var marker;
  var latitude = parseFloat('{LATITUDE}');
  var longitude = parseFloat('{LONGITUDE}');
  
  var mymap = L.map('mapid').setView([latitude, longitude], 18);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'RevoTOR Systems 2023',
    maxZoom: 18
  }).addTo(mymap);
  L.marker([latitude, longitude]).addTo(mymap);
  
  function updateMap(latitude, longitude) {
  mymap.setView([latitude, longitude], 18);
  if (marker) {
    mymap.removeLayer(marker);
  }
  marker = L.marker([latitude, longitude]).addTo(mymap);
}
  updateMap(parseFloat('{LATITUDE}'), parseFloat('{LONGITUDE}'));
  
</script>
